{%- assign limit = section.settings.products_per_page -%}
{% if template == "collection.leftsidebar" %}
  {% assign viewtype = "leftsidebar" %}
{% elsif template == "collection.rightsidebar" %}
  {% assign viewtype = 'rightsidebar' %}
{% elsif template == "collection.full_width" %}
  {% assign viewtype = 'full_width' %}
{% elsif template == "collection.canvas" %}
  {% assign viewtype = 'canvas' %}
{% else %}
  {% if settings.type_sidebar == 'sidebar_left' %}
    {% assign viewtype = 'leftsidebar' %}
  {% elsif settings.type_sidebar == 'sidebar_right' %}
    {% assign viewtype = 'rightsidebar' %}
  {% elsif settings.type_sidebar == 'full_width' %}
    {% assign viewtype = 'full_width' %}
  {% else %}
    {% assign viewtype = 'canvas' %}
  {% endif %}
{% endif %}
{% include 'nov-breadcrumb' %}
<div id="main-collection-filters" data-id="{{ section.id }}">
  <div class="container_90 {% if settings.breadcrumbs_enable %} collection_mt{% endif %}">
    <div class="collection-{{ viewtype }}">
    {% if viewtype != 'full_width' %}
      <div class="container_1320">
    {% endif %}
      <div class="d-flex align-items-center pt-60 pb-60 pt-lg-40 pb-lg-30 pt-xs-30">
        <div class="filter_button{% if viewtype != 'canvas' %} d-lg-none{% endif %}">
          <i class="zmdi zmdi-tune"></i>
          <span class="d-none d-md-inline-block">{{ 'collections.filters.button' | t }}</span>
        </div>
        <div class="bl_right d-flex align-items-center">
          <div class="gridlist-toggle order-2 order-md-0">
            {% if viewtype == 'canvas' %}
              <a href="#" id="list" title="List View" data-type="list"><i class="active zmdi zmdi-view-headline"></i></a>
            {% endif %}
             <a href="#" id="grid-4" title="Grid View 4" data-type="grid-4" class="d-none d-lg-block"><i class="zmdi zmdi-view-comfy"></i></a>
             
              
          </div>
          {% if section.settings.sort_enable %}
            <div class="" data-sortby-filter>
              <div class="dropdown-toggle d-flex align-items-center pb-5 pb-xs-0" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="sort-by__label"></span>
                <i class="zmdi zmdi-caret-down"></i>
              </div>
              <div class="dropdown-menu dropdown-menu-right text-right">
                {%- for option in collection.sort_options -%}
                  <div value="{{ option.value | escape }}" data-sortby-item>{{ option.name | escape }}</div>
                {%- endfor -%}
              </div>

            </div>
          {% endif %}
        </div>
      </div>
      <div class="row">
        {% if section.settings.banner != blank %}
          <div class="col-12 mb-60">
            <div class="collection_banner">
              <img class="lazyload" data-src="{{ section.settings.banner | img_url: '1920x' }}" alt="banner" width="auto" height="auto">
            </div>
          </div>
        {% endif %}
        <div class="col-lg-3 sidebar-filter{% if viewtype == 'rightsidebar' %} order-0 order-md-2{% endif %}">
          {% include 'collection-filters', results: collection %}
        </div>
        <div class="{% if viewtype == 'canvas' %}col-lg-12 col-md-12{% else %}col-lg-9{% endif %}">
          <div class="collection__product-content collection--product-{{ viewtype }}" {% if viewtype == 'canvas' %}data-grid="grid-4"{% else %}data-grid="grid-3"{% endif %}>
            <div id="ProductGridContainer">
              {%- paginate collection.products by section.settings.products_per_page -%} 
                {%- if collection.products.size == 0 -%}
                  <div id="product-grid" data-id="{{ section.id }}" class="text-center pt-60">
                    <h2 class="mb-20">{{ 'collections.filters.empty' | t }}</h2>
                    <h4>{{ 'collections.filters.use_fewer_filters_html' | t: link: collection.url }}</h4>
                  </div>
                {%- else -%}
                  <div id="product-grid" data-id="{{ section.id }}" class="row grid--view-items spacing-md-15">
                    {%- for product in collection.products -%}
                      <div class="product--item col">
                        <div class="item-product{% unless product.available %} product-price--sold-out{% endunless %}">
                          {% assign variantCount = product.variants | size %}
                          {%- assign img_size = settings.img_size_large -%}
                          <div class="thumbnail-container{% if product.images.size > 2 %} has-multiimage{% endif %}{% if section.settings.show_variant_color and variantCount > 1 %} has_variants{% endif %}">
                            <a href="{{ product.url | within: collection }}">
                              <div class="respone_image" style="padding-top:{{ 1 | divided_by: product.featured_image.aspect_ratio | times: 100}}%">
                                {% assign img_url = product.featured_image | img_url: '1x1' | replace: '_1x1.', '_{width}x.' %}
                                <noscript>
                                  <img class="img-fluid product__thumbnail-second lazyload" data-src="{{ product.featured_image.src | img_url: '1024x' }}" alt="" width="auto" height="auto">
                                </noscript>
                                <img class="product__thumbnail lazyload"
                                  src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 7 10'%3E%3C/svg%3E"
                                  data-src="{{ img_url }}"
                                  data-widths="[360, 540, 720, 900, 1080, 1296, 1512, 1728, 1944, 2048, 4472]"
                                  data-aspectratio="{{ product.featured_image.aspect_ratio }}"
                                  data-sizes="auto"
                                  alt="" 
                                  data-image
                                  width="auto" height="auto" loading="lazy">
                                {% for image in product.images %}
                                  {% assign img_second = image.src | img_url: '1x1' | replace: '_1x1.', '_{width}x.' %}
                                  {% if forloop.first != true %}
                                    <img id="{{ img_id }}"
                                      class="img-fluid product__thumbnail-second lazyload"
                                      src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 7 10'%3E%3C/svg%3E"
                                      data-src="{{ img_second }}"
                                      data-widths="[180, 360, 540, 720, 900, 1080, 1296, 1512, 1728, 2048]"
                                      data-aspectratio="{{ image.aspect_ratio }}"
                                      data-sizes="auto"
                                      alt="{{ product.title }}"
                                      data-image
                                      width="auto" height="auto" loading="lazy">
                                    {% break %}
                                  {% endif %}
                                {% endfor %}
                              </div>
                            </a>
                         {% comment %}   {% include 'group_buttons' %} {% endcomment %}
                          </div>
                          <div class="product__info">
                            <div class="block_product_info">
                              <div class="cate">
                                {% for collection in product.collections %}
                                  {% if forloop.first == true %}
                                    <a href="{{ collection.url }}" title="{{ collection.title }}">{{ collection.title }}</a>
                                  {% endif %}
                                {% endfor %}
                              </div>
                              <div class="product__title">
                                <a href="{{ product.url | within: collection }}">{{ product.title }}</a>
                              </div>
                      {% render 'judgeme_widgets', widget_type: 'judgeme_preview_badge', jm_style: '', concierge_install: false, product: product %}
                              <div class="product__price{% if settings.show_rating == false %} pb-20{% endif %}">
                                {% include 'product-price' %}
                              </div>
                              {% if product.variants.size > 0 %}
                                {% if section.settings.show_variant_color %}
                                  <div class="selectorVariants {% if product.variants.size > 0 %} has-border{% endif %}">
                                    {% include 'nov-swatch-color' with 'Color' %}
                                  </div>
                                {% endif %}
                              {% endif %}
                              {% unless product.available %}
                                <div class="available_product d-flex">
                                  <span class="product__available sold-out mt-15">
                                    <i class="zmdi zmdi-alert-octagon"></i>
                                    <span>{{ "products.product.sold_out" | t }}</span>
                                  </span>
                                </div>
                              {% else %}
                                <div class="available_product d-flex">
                                  <span class="product__available in-stock mt-15">
                                    <i class="fa fa-check-square-o" aria-hidden="true"></i>
                                    <span>{{ "products.product.in_stock" | t }}</span>
                                  </span>
                                </div>
                              {% endunless %}
                              <div class="desc mt-15">{{ product.description | strip_html | truncate: 230 }}<a href="{{ product.url | within: collection }}"><b>(read more)</b></a></div>

                              
                            </div>
                            {% if product.available == true %}
          <form action="/cart/add" method="post">
            <input type="hidden" name="id" value="{{ product.variants.first.id }}">
            {% if variantCount > 1 %}
              <a class="btn btnAddToCart btnChooseVariant dca" href="javascript:void(0);" data-url="/products/{{ product.handle }}?view=json"
                {% if settings.tooltip_enable %} data-toggle="tooltip" data-placement="top" {% endif %} title="" tabindex="0">
                <span class="burr"><i class="icon_sellect"></i><p class="fv">Choose variant</p></span>
              </a> 
            {% else %}
                <button class="btn btnAddToCart dca" type="submit" value="Submit" data-handle="{{ product.handle }}" data-pid="{{ product.variants.first.id }}"{% if settings.tooltip_enable %} data-toggle="tooltip" data-placement="top"{% endif %} title="" tabindex="0">{{ 'products.product.add_to_cart' | t }}</button>
            {% endif %}              
          </form>

    {% endif %}
                          </div>
                        </div>
                      </div>
                    {%- endfor -%}
                  </div>

                  {%- if paginate.pages > 1 -%}
                    <div class="nov-pagination d-flex align-items-center">{% render 'pagination', paginate: paginate, anchor: '', class: '' %}</div>
                  {%- endif -%}
                {%- endif -%}
              {%- endpaginate -%}
            </div>
          </div>
        </div>
      </div>
    {% if viewtype == 'leftsidebar' or viewtype == 'rightsidebar' %}
    </div>
    {% endif %}
    {% if viewtype != 'full_width' %}
    </div>
    {% endif %}
    {% comment %}
    {% include 'collection-filters-mobile' %}
    {% endcomment %}
    <div class="product-count light d-none" role="status">
      <h2 class="product-count__text text-body">
        <span id="ProductCount">
          {% comment %}
          {%- if collection.collection_count -%}
            {{ 'templates.search.collection_with_count' | t: terms: collection.terms, count: collection.collection_count }}
          {%- elsif collection.products_count == collection.all_products_count -%}
            {{ 'products.facets.product_count_simple' | t: count: collection.products_count }}
          {%- else -%}
            {{ 'products.facets.product_count' | t: product_count: collection.products_count, count: collection.all_products_count }}
          {%- endif -%}
          {% endcomment %}
        </span>
      </h2>
    </div>
    <script src="{{ 'collection-filters-form.js' | asset_url }}" defer="defer"></script>
  </div>
</div>
{% schema %}
  {
    "name": "Collection pages",
    "settings": [
      {
        "type": "image_picker",
        "id": "banner",
        "label": "Banner"
      },
      {
        "type": "range",
        "id": "products_per_page",
        "min": 4,
        "max": 30,
        "step": 1,
        "label": "Products per page",
        "default": 12,
        "info": "Select number products per page"
      },
      {
        "type": "checkbox",
        "id": "show_variant_color",
        "label": "Show Variant Color",
        "default": false
      },
      {
        "type": "checkbox",
        "id": "sort_enable",
        "label": "Enable sorting",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "show_tags",
        "label": "Show tags",
        "default": true
      }
    ]
  }
{% endschema %}

{% if viewtype == 'full_width' %}
  <style>
    .template-collection #NovBreadcrumbs {
      padding-bottom: 126px !important;
    }
    @media (max-width: 1199px) {
      .template-collection #NovBreadcrumbs {padding-bottom: 90px !important;}
    }
    @media (max-width: 991px) {
      .template-collection #NovBreadcrumbs {padding-bottom: 90px !important;}
    }
    @media (max-width: 767px) {
      .template-collection #NovBreadcrumbs {padding-bottom: 55px !important;}
    }
  </style>
{% endif %}

{% if viewtype == 'canvas' %}
<style>
.mt-15 {
    margin-top: 0;
    padding: 0;
}
.available_product.d-flex {
    display: none !important;
}
  .template-collection .collection__product-content[data-grid=list] .product--item .item-product .product__info .product__title {
    font-size: 2.3rem;
}
  .item-product .icon_sellect {
    width: 17px;
    height: 17px;
}
  span.burr {
    display: flex;
    align-items: center;
}
.dca {
    background: yellow;
    border: 2px solid;
    margin-top: 10px;
    padding: 6px 20px;
    font-weight: 700;
    min-width: 60%;
}
  p.fv {
    margin-left: 10px;
}
  .dca:hover {
    color: white;
  }
  .template-collection .collection__product-content[data-grid=list] .product--item .product__info {
    padding: 20px;
}
  .cate {
    display: none;
}
  .item-product .product__info .product__title {
    margin: 5px 0 5px;
}
  .jdgm-widget.jdgm-preview-badge.jdgm--done-setup {
    margin-bottom: 10px;
}
  .item-product .product__info {
    position: relative;
    z-index: 9;
    min-height: 170px;
    justify-content: space-between;
    display: flex;
    flex-direction: column;
}
  @media (max-width: 575px)
  { 
.item-product .product__info {
    padding: 0;
}
  }
</style>
<script>
$(document).ready(function() {
  function updateView() {
    if ($(window).width() > 767) {
      if (!$('.gridlist-toggle [data-type="grid-4"]').hasClass('active')) {
        $('.collection__product-content').attr('data-grid', 'grid-4');
        $('.gridlist-toggle a').removeClass('active');
        $('.gridlist-toggle [data-type="grid-4"]').addClass('active');
        localStorage.setItem('view_collection', 'grid-4');
      }
    } else {
      if (!$('.gridlist-toggle [data-type="list"]').hasClass('active')) {
        $('.collection__product-content').attr('data-grid', 'list');
        $('.gridlist-toggle a').removeClass('active');
        $('.gridlist-toggle [data-type="list"]').addClass('active');
        localStorage.setItem('view_collection', 'list');
      }
    }
  }

  // Update view on window resize
  $(window).on('resize', function() {
    updateView();
  });

  // Trigger the resize event on page load
  $(window).on('load', function() {
    $(window).trigger('resize');
  });
});

</script>
{% endif %}
</div>